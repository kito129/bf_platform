<div class="card">
  <!-- HEADER -->
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-baseline">
      <h5>Rules</h5>
      <button type="button"
              class="btn btn-success mr-2"
              (click)="addRule()">
        Add Rule
      </button>

      <button type="button"
              class="btn btn-primary"
              [disabled]="!myForm.valid"
              (click)="submitForm()">
        Submit
      </button>

    </div>
  </div>
  <!-- BODY -->
  <div class="card-body">
    <form ngForm class="form-group" [formGroup]="myForm">
      <!-- NAME -->
      <label for="name">Name</label>
      <input id="name"
             class="form-control"
             formControlName="name">
      <span class="text-danger" *ngIf="name.invalid">Must not be empty</span>
      <!-- FORM -->
      <div class="form-group" formArrayName="rule">
        <ul class="list-group">
          <li class="list-group-item" *ngFor="let rule of rules.controls; let i=index"
              [formGroupName]="i">
            <div class="row">
              <div class="col">
                <div class="d-flex justify-content-between align-items-baseline">
                  <h4 class="text-gray mr-2">{{i+1}}</h4>

                  <input id="ruleName"
                         class="form-control"
                         formControlName="name">
                  <span class="text-danger" *ngIf="getRuleName(i).invalid">Must not be empty</span>
                </div>
                <!-- NAV BAR -->
                <ul ngbNav #defaultNav="ngbNav" [(activeId)]="defaultActive[i]" class="nav-tabs">
                  <!-- SELECTION -->
                  <li [ngbNavItem]="1">
                    <a ngbNavLink>Selection</a>
                    <ng-template ngbNavContent>
                      <div class="form-group" [formGroupName]="'selection'">
                        <!-- OPTIONS -->
                        <label for="selectionOptions">Selection Options</label>
                        <ng-select id="selectionOptions"
                                   formControlName="options"
                                   [items]="['fixed', 'dynamic']"
                                   [clearable]="false">
                        </ng-select>
                        <!-- FIXED -->
                        <div *ngIf="myForm.value.rule[i].selection.options==='fixed'" class="row form-group" [formGroupName]="'fixed'">
                          <div class="col-4">
                            <label for="fixedType">Fixed Type</label>
                            <ng-select id="fixedType"
                                       [items]="['selections #', 'selections Id','selection Type']"
                                       formControlName="fixedOptions"
                                       [clearable]="false">
                            </ng-select>
                          </div>
                          <div class="col">
                            <div *ngIf="myForm.value.rule[i].selection.fixed.fixedOptions==='selections #'">
                              <label for="selectionNumber">Selection #</label>
                              <input type="number"
                                     class="form-control"
                                     id="selectionNumber"
                                     formControlName="selectionN">
                            </div>
                            <div *ngIf="myForm.value.rule[i].selection.fixed.fixedOptions==='selections Id'">
                              <label for="selectionId">Selection id</label>
                              <input type="number"
                                     class="form-control"
                                     id="selectionId"
                                     formControlName="selectionId">
                            </div>
                            <div *ngIf="myForm.value.rule[i].selection.fixed.fixedOptions==='selection Type'">
                              <label for="selectionType">Selection Type</label>
                              <ng-select id="selectionType"
                                         [items]="['winner', 'loser', 'favourite selection', 'underdog selection']"
                                         formControlName="selectionType"
                                         [clearable]="false">
                              </ng-select>
                            </div>
                          </div>
                        </div>
                        <!-- DYNAMIC -->
                        <div *ngIf="myForm.value.rule[i].selection.options==='dynamic'" class="row form-group"  [formGroupName]="'dynamic'">
                          <div class="col-4">
                            <label for="dynamicOptions">Dynamic Options</label>
                            <ng-select id="dynamicOptions"
                                       formControlName="dynamicOptions"
                                       [items]="['bsp', 'bspWinner', 'bspLoser']"
                                       [clearable]="false">
                            </ng-select>
                          </div>
                          <div class="col">
                            <div class="form-group" [formGroupName]="'range'">
                              <div class="row">
                                <div class="col">
                                  <label for="minRange">min</label>
                                  <input type="number"
                                         class="form-control"
                                         id="minRange"
                                         formControlName="min">
                                </div>
                                <div class="col">
                                  <label for="maxRange">Max</label>
                                  <input type="number"
                                         class="form-control"
                                         id="maxRange"
                                         formControlName="max">
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </ng-template>
                  </li>
                  <!-- CONDITIONS -->
                  <li [ngbNavItem]="2">
                    <a ngbNavLink>Conditions</a>
                    <ng-template ngbNavContent>
                    </ng-template>
                  </li>
                  <!-- BET -->
                  <li [ngbNavItem]="3">
                    <a ngbNavLink>Bet</a>
                    <ng-template ngbNavContent>
                      <div class="form-group" [formGroupName]="'bet'">
                        <!-- OPTIONS -->
                        <div>
                          <label for="betOptions">Bet Options</label>
                          <ng-select id="betOptions"
                                     formControlName="options"
                                     [items]="['place lay', 'place back', 'cashOut']"
                                     [clearable]="false">
                          </ng-select>
                        </div>
                        <!-- PLACE -->
                        <div class="row form-group" [formGroupName]="'place'">
                          <div class="col">
                            <label for="placeType">Place Type</label>
                            <ng-select id="placeType"
                                       formControlName="type"
                                       [items]="['fixed price', 'best price']"
                                       [clearable]="false">
                            </ng-select>
                          </div>
                          <div class="col" >
                            <div *ngIf="myForm.value.rule[i].bet.place.type==='fixed price'">
                              <label for="fixedPriceValue">Fixed Price</label>
                              <input type="number"
                                     class="form-control"
                                     id="fixedPriceValue"
                                     formControlName="fixedPriceValue">
                            </div>
                          </div>
                        </div>
                        <!-- NOT CASHOUT -->
                        <div  *ngIf="myForm.value.rule[i].bet.options!=='cashOut'">
                          <!-- STAKE -->
                          <div class="row form-group" [formGroupName]="'stake'">
                            <div class="col">
                              <label for="stakeType">Stake Type</label>
                              <ng-select id="stakeType"
                                         formControlName="type"
                                         [items]="['net stake', 'fixed']"
                                         [clearable]="false">
                              </ng-select>
                            </div>
                            <!-- STAKE FIXED-->
                            <div class="col" *ngIf="myForm.value.rule[i].bet.stake.type==='fixed'">
                              <label for="fixedStake">Fixed Stake</label>
                              <input type="number"
                                     class="form-control"
                                     id="fixedStake"
                                     formControlName="fixed">
                            </div>
                            <div class="col" *ngIf="myForm.value.rule[i].bet.stake.type==='fixed'">
                              <label for="liability">Liability</label>
                              <input type="number"
                                     class="form-control"
                                     id="liability"
                                     formControlName="liability">
                            </div>
                            <div class="col" *ngIf="myForm.value.rule[i].bet.stake.type==='fixed'">
                              <label for="toWin">To Win</label>
                              <input type="number"
                                     class="form-control"
                                     id="toWin"
                                     formControlName="toWin">
                            </div>
                          </div>
                          <!-- OFFSET -->
                          <div class="form-group" [formGroupName]="'offset'">
                            <label for="offsetType">Offset Type</label>
                            <ng-select id="offsetType"
                                       formControlName="type"
                                       [items]="['off', 'offset', 'offset green', 'offset and stop', 'offset green and stop']"
                                       [clearable]="false">
                            </ng-select>
                            <div class="row" *ngIf="myForm.value.rule[i].bet.offset.type!=='off'">
                              <!-- OFFSET OPTIONS-->
                              <div class="col">
                                <label for="offsetOptions">Offset Options</label>
                                <ng-select id="offsetOptions"
                                           formControlName="options"
                                           [items]="['tick', '%', 'rR']"
                                           [clearable]="false">
                                </ng-select>
                              </div>
                              <div class="col">
                                <label for="value">Value</label>
                                <input type="number"
                                       class="form-control"
                                       id="value"
                                       formControlName="value">
                              </div>
                              <!-- OFFSET STOP OPTIONS-->
                              <div class="col" *ngIf="(myForm.value.rule[i].bet.offset.type==='offset and stop') || (myForm.value.rule[i].bet.offset.type==='offset green and stop')">
                                <label for="offsetStopOptions">Offset Stop Options</label>
                                <ng-select id="offsetStopOptions"
                                           formControlName="optionsStop"
                                           [items]="['tick', '%', 'rR']"
                                           [clearable]="false">
                                </ng-select>
                              </div>
                              <div class="col"  *ngIf="(myForm.value.rule[i].bet.offset.type==='offset and stop') || (myForm.value.rule[i].bet.offset.type==='offset green and stop')">
                                <label for="valueStop">Value Stop</label>
                                <input type="number"
                                       class="form-control"
                                       id="valueStop"
                                       formControlName="valueStop">
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>
                    </ng-template>
                  </li>
                </ul>

                <div [ngbNavOutlet]="defaultNav" class="border border-top-0 p-1"></div>


              </div>
              <div class="col-1">


                <button type="button"
                        class="btn btn-xs btn-outline-primary mb-2"
                        (click)="upRule(i)">
                  <i class="btn-icon-prepend"
                     data-feather="arrow-up"
                     appFeatherIcon></i>
                </button>

                <button type="button"
                        class="btn btn-xs btn-outline-primary mb-2"
                        (click)="downRule(i)">
                  <i class="btn-icon-prepend"
                     data-feather="arrow-down"
                     appFeatherIcon></i>
                </button>

                <button type="button"
                        class="btn btn-xs btn-primary mb-2"
                        (click)="resetRule(i)">
                  Reset
                </button>
                <button type="button"
                        class="btn btn-xs btn-secondary mb-2"
                        (click)="duplicateRule(i)">
                  Duplicate
                </button>
                <button type="button"
                        class="btn btn-xs btn-danger"
                        (click)="deleteRule(i)">
                  Delete
                </button>
              </div>
            </div>
          </li>
          <li class="list-group-item disabled text-danger" *ngIf="rules.length===0">At Least one Rule</li>
        </ul>

      </div>
    </form>
  </div>
  <pre>
      {{myForm.value | json}}
  </pre>
</div>






